# DataFrame 생성

데이터프레임은 2차원 테이블 형태의 데이터에 인덱스를 붙인 것으로 행, 열로 이루어져 있다. 판다스의 데이터프레임은 1차원적 시리즈들이 모이고 모여서 표를 이룬 것이라 생각하면 쉽다.

데이터프레임 생성은 상당히 간단하다. 많지 않은 데이터일 경우 예제로 하나 만들어볼 수 있다.

## 1. 리스트를 이용해 생성

리스트로 기본적인 형태의 데이터프레임을 생성해볼 수 있다.

```py
dataframe = pd.DataFrame([
    ['a1', 'b1', 'c1'],
    ['a2', 'b2', 'c2']],
    index=[1, 2],
    columns=['a', 'b', 'c']
)
```

index란 행을 뜻한다. 가로 방향으로 한 줄씩 쌓인다.

columns는 열을 뜻한다. 세로 방향으로 나열되는 데이터 형태다. 실행시켜 결과를 확인해보면 아래와 같다.

```py
    a	b	c
1	a1	b1	c1
2	a2	b2	c2
```

index와 columns가 어디로 들어갔는지 확인해보면 이해할 수 있을 것이다.

만약 3번째 줄 데이터가 없는데도 index에 3을 명시한다면 3번째 줄은 모두 NaN 값이 들어가게 된다.

모든 index와 column은 숫자, 문자 전부 가능하다. 단지 나중에 loc, iloc를 이용한 인덱싱 방법에 차이가 있을 뿐이다.

## 2. 딕셔너리를 이용해 생성

딕셔너리는 key:value 값이 대응하니 더 간편하게 데이터프레임을 생성할 수 있다. 아래는 예제이다.

```py
data = {
    '유튜버':['소심이', '소심이', '까칠이', '까칠이'],
    '구독자':['유튜브','트위치','유튜브','트위치'],
    '2023': [101277, 3183, 5837, 350],
    '2022': [99743, 2994, 5010, 285],
    '2021': [91155, 2475, 3187, 211],
    '2020': [86148, 1972, 2660, 105]
}

youtube_watcher=pd.DataFrame(data)
```

데이터를 넣고 생성하면 아래와 같은 결과가 나올 것이다.

```py
	유튜버	구독자	2023	2022	2021	2020
0	소심이	유튜브	101277	99743	91155	86148
1	소심이	트위치	3183	2994	2475	1972
2	까칠이	유튜브	5837	5010	3187	2660
3	까칠이	트위치	350 	285 	211 	105
```

# 데이터 수정, 추가, 삭제

본격적인 CRUD 작업을 진행해보자. 만들어둔 youtube_watcher 데이터프레임을 이용해 몇 가지 연습을 해본다.

## 1. 데이터 뽑기

소심이의 유튜브 구독자 중 2022년의 구독자 수를 알고 싶다. 여기서 loc와 iloc는 문법이 다르다. 세 가지 예제를 통해 알아보자.

```py
youtube_watcher['2022'][0]
youtube_watcher.loc[0, '2022']
youtube_watcher.iloc[0, 3]
```

결과는 모두 '99743'이 나올 것이다. 저 문법의 뜻이 뭘까?

### 각 인덱서 설명

1. 일반 인덱서  
[열] -> [행] 순서로 찾아간다. 열 이름을 먼저 적고 행을 적는다.

2. loc 인덱서  
[행 -> 열] 순서로 찾아간다. 이때 인덱스 이름, 행 이름 순서로 나아간다. 만약 인덱스가 'a'이고 행 이름이 'total'이라면 df.loc['a', 'total'] 순서로 적는다.

3. iloc 인덱서  
[행 -> 열] 순서로 찾아가는건 똑같은데, 0-base 인덱스로 찾아간다. 인덱스 이름이 뭐든 간에 0부터 인덱스 길이까지의 절대값을 기준으로 찾아간다. 위 예제에서 '2022'열은 4번째 열이기 때문에 3을 적어야 제 자리를 찾아간다.

## 2. set_index

데이터 행이 길고 많아지면 특정 데이터를 뽑기 위해 거쳐야 하는 단계가 많을 것이다. 현 데이터프레임은 index가 0-base 이므로 데이터를 찾기 더더욱 힘들다.

데이터프레임을 자세히 보면 index로 설정하면 좋을 것 같은 열이 보일 것이다. '유튜버'와 '구독자'는 같은 값이 반복되고 있어 잘 묶기만 하면 원하는 데이터로 접근하는 게 더 쉬워질 것 같다.

이때 쓰는 함수가 set_index()이다. 괄호 안에 index로 지정하고픈 열을 넣으면 자동으로 index 지정을 해주는 함수다. 한번 직접 써보자.

```py
youtube_watcher.set_index('유튜버')
```

결과

```py
	    구독자	2023	2022	2021	2020
유튜버					
소심이	유튜브	101277	99743	91155	86148
소심이	트위치	3183	2994	2475	1972
까칠이	유튜브	5837	5010	3187	2660
까칠이	트위치	350 	285 	211 	105
```

이제 소심이의 유튜브 구독자 수만 뽑아보자.

```py
youtube_watcher.loc['소심이']
```

분명 저대로 실행하면 key Error를 맞닥뜨릴 것이다. 왜일까?

set_index만 실행하면 실제 데이터프레임에 반영되지 않기 때문이다. inplace=True를 넣어주면 실제 데이터프레임에 반영된다.

```py
youtube_watcher.set_index('유튜버', inplace=True)
```

유튜버를 새 index로 지정했으니 이제 소심이의 유튜브 구독자 수 변화를 알아보자.

```py
youtube_watcher.loc['소심이']
```

결과

```py
	    구독자	2023	2022	2021	2020
유튜버					
소심이	유튜브	101277	99743	91155	86148
소심이	트위치	3183	2994	2475	1972
```

아까보다 보기 나아졌지만, 여전히 문제가 있다. 유튜브와 트위치 모두 노출된다는 것이다. 이것은 '유튜버' 행만 인덱싱이 되어 있어 나머지 행의 정보다 죄다 출력되기 때문이다. 구독자도 인덱스로 묶을 수 있다면 '소심이'의 '유튜브'와 '트위치' 구독자 모두 따로 뽑을 수 있지 않을까?

이제 메소드 체이닝(method chaining)과 리스트 묶기를 사용하여 인덱스를 묶어보도록 하자.

```py
youtube_watcher.set_index(['유튜버', '구독자'])
```

결과

```py

                2023	2022	2021	2020
유튜버	구독자				
소심이	유튜브	101277	99743	91155	86148
        트위치	3183	2994	2475	1972
까칠이	유튜브	5837	5010	3187	2660
        트위치	350 	285 	211 	105
```

리스트로 묶었더니 반복되는 인덱스는 알아서 하나로 합쳐지고 이중인덱스가 만들어졌다. 이제 소심이의 유튜브 구독자 변화 추이와 트위치 구독자 변화를 따로 노출시킬 수 있게 되었다. 한번 해보자.

```py
youtube_watcher.loc['소심이'].loc[['유튜브']]
youtube_watcher.loc['소심이'].loc[['트위치']]
```

참고로 [] 대괄호 하나만 감싸면 시리즈 형태로, [[]] 두 번 감싸면 데이터프레임 형태로 출력된다.

```py
	    2023	2022	2021	2020
구독자				
유튜브	101277	99743	91155	86148


        2023	2022	2021	2020
구독자				
트위치	3183	2994	2475	1972
```

이제 데이터를 따로따로 볼 수 있게 되었다.

## 2. 데이터 가공

기존의 데이터를 이용하여 새로운 열을 추가할 수 있다. 이것을 '가공열'이라 한다. 가공열을 만들기 위해 기존 데이터프레임을 copy()하고 2020년부터 2023년까지의 구독자 수 증가율을 출력해보자.

```py
watcher2 = youtube_watcher.copy()
```

이제 가공열을 추가해보자

```py
watcher2['2020-2023 구독자 증가율'] = ((watcher2['2023']-watcher2['2020'])/watcher2['2020']*100).round(2)
```

결과

```py
	        	2023	2022	2021	2020	2020-2023 구독자 증가율
유튜버	구독자					
소심이	유튜브	101277	99743	91155	86148	17.56
        트위치	3183	2994	2475	1972	61.41
까칠이	유튜브	5837	5010	3187	2660	119.44
        트위치	350 	285 	211 	105 	233.33
```

데이터를 살펴보면 소심이와 까칠이의 유튜브, 트위치 구독자 수는 2020년 대비 적게는 17.56%, 많게는 233.33% 늘었다는 사실을 알 수 있다.